Acc={rand:function(){if(0===arguments.length)return Math.random();if(1==arguments.length)return Math.floor(Math.random()*arguments[0]);if(arguments.length>=2){if(arguments[0]>arguments[1]){var a=arguments[0];arguments[0]=arguments[1],arguments[1]=a}return arguments[1]++,Math.floor(Math.random()*(arguments[1]-arguments[0]))+arguments[0]}},interpretArithmeticString:function(a){for(var e=[],r="",t=null,s=0;s<a.length;s++){switch(a[s]){case"-":null!=t&&"0123456789".indexOf(t)>-1?e.push("-"):r+=a[s];break;case"!":e.push("!");break;case"+":e.push("+");break;case"*":e.push("*");break;case"/":e.push("/");break;case"%":e.push("%");break;case"^":e.push("^");break;case"d":e.push("d");break;case"(":for(var c=-1,i=1,n=s+1;n<a.length;n++)")"==a[n]?i--:"("==a[n]&&i++,0==i&&(c=n,n=a.length);if(c<0)return console.warn("poorly formed input!",a),[0];var h=a.substr(s,c+1-s);e.push(this.interpretArithmeticString(h.substr(1,h.length-2))),s=c;break;case")":break;default:"0123456789.".indexOf(a[s])>-1&&(r+=a[s]),(a.length==s+1||"-+*/%^d()!".indexOf(a[s+1])>-1)&&(e.push(r),r="")}t=a[s]}return e},factorialCache:{},parseEquation:function(a,e){e=void 0==e?"normal":e.toLowerCase(),"string"==typeof a&&(a=this.interpretArithmeticString(a));for(var r=0;r<a.length;r++)Array.isArray(a[r])?a[r]=this.parseEquation(a[r],e):isNaN(parseFloat(a[r]))||(a[r]=parseFloat(a[r]));for(;a.length>1;){var t=0,s=-1;for(r=0;r<a.length;r++)if("string"==typeof a[r]){var c=0;switch(a[r]){case"+":case"-":c=1;break;case"d":c=2;break;case"/":case"*":case"%":c=3;break;case"^":c=4;break;case"!":case"log":c=5;break;default:console.warn("unweighted operator",a[r])}c>t&&(t=c,s=r)}var i,n,h,o,l=["!","log"].indexOf(a[s])>-1;if(s<1&&!l||s>a.length-2&&!l)return console.warn("likely bad input... failing gracefully",JSON.stringify(a),s,l),a[0];l?(i=(h=a.splice(s,2))[1],o=h[0]):(s--,i=(h=a.splice(s,3))[0],n=h[2],o=h[1]);var f=0;switch(o){case"log":(f=Math.log(i))==-1/0&&(f=0);break;case"!":if(void 0!=this.factorialCache[i]){f=this.factorialCache[i];break}f=i;for(r=i-1;r>1;r--)f*=r;this.factorialCache[i]=f;break;case"+":f=i+n;break;case"-":f=i-n;break;case"/":f=i/n;break;case"%":f=i%n;break;case"*":f=i*n;break;case"^":f=Math.pow(i,n);break;case"d":var b=i,u=n;if(b<0)for(r=0;r<Math.abs(b);r++)switch(e){case"normal":f-=Acc.rand(1,u);break;case"max":f-=Math.min(u,1);break;case"min":f-=Math.max(u,1)}else for(r=0;r<b;r++)switch(e){case"normal":f+=Acc.rand(1,u);break;case"max":f+=Math.max(u,1);break;case"min":f+=Math.min(u,1)}}a.splice(s,0,f)}return a[0]}};