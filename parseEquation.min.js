Acc={rand:function(){if(0===arguments.length)return Math.random();if(1==arguments.length)return Math.floor(Math.random()*arguments[0]);if(arguments.length>=2){if(arguments[0]>arguments[1]){var a=arguments[0];arguments[0]=arguments[1],arguments[1]=a}return arguments[1]++,Math.floor(Math.random()*(arguments[1]-arguments[0]))+arguments[0]}},interpretArithmeticString:function(a){for(var b=[],c="",d=null,e=0;e<a.length;e++){switch(a[e]){case"-":null!=d&&"0123456789".indexOf(d)>-1?b.push("-"):c+=a[e];break;case"!":b.push("!");break;case"+":b.push("+");break;case"*":b.push("*");break;case"/":b.push("/");break;case"%":b.push("%");break;case"^":b.push("^");break;case"d":b.push("d");break;case"(":for(var g=-1,h=1,i=e+1;i<a.length;i++)")"==a[i]?h--:"("==a[i]&&h++,0==h&&(g=i,i=a.length);if(g<0)return console.warn("poorly formed input!",a),[0];var j=a.substr(e,g+1-e);b.push(this.interpretArithmeticString(j.substr(1,j.length-2))),e=g;break;case")":break;default:"0123456789.".indexOf(a[e])>-1&&(c+=a[e]),(a.length==e+1||"-+*/%^d()!".indexOf(a[e+1])>-1)&&(b.push(c),c="")}d=a[e]}return b},factorialCache:{},parseEquation:function(a,b){void 0==b&&(b="normal"),"string"==typeof a&&(a=this.interpretArithmeticString(a));for(var c=0;c<a.length;c++)Array.isArray(a[c])?a[c]=this.parseEquation(a[c],b):isNaN(parseFloat(a[c]))||(a[c]=parseFloat(a[c]));for(;a.length>1;){for(var d=0,e=-1,c=0;c<a.length;c++)if("string"==typeof a[c]){var f=0;switch(a[c]){case"+":f=1;break;case"-":f=1;break;case"d":f=2;break;case"/":f=3;break;case"*":f=3;break;case"%":f=3;break;case"^":f=4;break;case"!":f=5;break;default:console.warn("unweighted operator",a[c])}f>d&&(d=f,e=c)}var g="!".indexOf(a[e])>-1;if(e<1||e>a.length-2&&!g)return console.warn("likely bad input... failing gracefully",JSON.stringify(a)),a[0];e--;var h=a.splice(e,g?2:3),i=h[0],j=h[2],k=h[1],l=0;switch(k){case"!":if(void 0!=this.factorialCache[i]){l=this.factorialCache[i];break}l=i;for(var c=i-1;c>1;c--)l*=c;this.factorialCache[i]=l;break;case"+":l=i+j;break;case"-":l=i-j;break;case"/":l=i/j;break;case"%":l=i%j;break;case"*":l=i*j;break;case"^":l=Math.pow(i,j);break;case"d":for(var m=i,n=j,c=0;c<m;c++)switch(b){case"normal":l+=Acc.rand(1,n);break;case"max":l+=n;break;case"min":l+=1}}a.splice(e,0,l)}return a[0]}};